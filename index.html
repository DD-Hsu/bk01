<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>æˆ‘çš„æ›¸ç±è³‡æ–™åº« + æ—¥èªŒ</title>
  <style>
    :root{
      --cover-bg:#233d4d;         /* é¦–é æ·±è— */
      --cover-fg:#f2eee8;
      --cover-border:#cfc7bb;
      --cover-accent:#fe7f2d;     /* æ©˜è‰²é»ç¶´ */

      --list-bg:#233d4d;          /* åˆ†é¡é ç¶­æŒæ·±è— */
      --list-fg:#f2eee8;
      --list-border:#cfc7bb;

      --card-accent:#fe7f2d;      /* åˆ†é¡æ¸…å–®å¡ç‰‡ hover */
      --gap:16px;
    }
    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:24px;
      font-family: Georgia, "Times New Roman", Times, serif;
      line-height:1.6; letter-spacing:.15px;
      background:var(--cover-bg); color:var(--cover-fg);
    }
    h1,h2{ margin:0 0 10px; font-weight:800; }
    h1{ font-size: clamp(28px, 4vw, 42px); }
    a{ color:inherit; text-decoration:none; border-bottom:1px solid transparent; }
    a:hover{ border-bottom-color:currentColor; }
    .hidden{ display:none !important; }

    /* å€å¡Šæ¨™é¡Œ */
    .section-title{
      margin:28px 0 8px;
      font-size:20px;
      color:var(--cover-accent);
      font-weight:900;
      letter-spacing:.5px;
    }

    /* é¦–é æ¿å¡Šï¼ˆåˆ†é¡ / æ—¥èªŒï¼‰ */
    .board{
      background:transparent;
      padding:18px;
      border:1px solid var(--cover-border);
      margin-bottom:16px;
    }
    .bar{
      display:flex; gap:12px; align-items:center; justify-content:space-between;
      margin: 6px 0 12px; flex-wrap:wrap;
    }
    .controls input, .controls select, .btn{
      padding:8px 10px; font-size:14px; outline:none;
      border:1px solid var(--cover-border);
      background:transparent; color:inherit;
    }
    .btn{ cursor:pointer; font-weight:800; }
    .tiles{
      display:grid;
      grid-template-columns: repeat(auto-fill, minmax(220px,1fr));
      gap:var(--gap);
      margin-top:10px;
    }
    .tile{
      display:flex; align-items:center; gap:12px;
      padding:14px 16px;
      background:transparent; color:inherit;
      border:1px solid var(--cover-border);
      cursor:pointer; font-weight:800;
    }
    .tile:hover{ background:#2a4a60; border-color:var(--cover-accent); color:var(--cover-accent); }

    /* æ¸…å–®é  */
    .grid{ column-count: 3; column-gap: var(--gap); }
    @media (max-width: 1100px){ .grid{ column-count:2; } }
    @media (max-width: 700px){ .grid{ column-count:1; } }

    .card{
      display:inline-block; width:100%;
      border:1px solid var(--list-border); background:transparent;
      padding:14px; margin:0 0 var(--gap); cursor:pointer;
      transition: background .15s ease, border-color .15s ease, color .15s ease;
    }
    .card:hover{ background:#2a4a60; border-color:var(--card-accent); color:var(--card-accent); }
    .title{ font-weight:900; }
    .meta{ opacity:.85; font-size:13px; }
    .tag{
      display:inline-block; padding:2px 8px; margin:6px 6px 0 0; font-size:12px;
      border:1px solid var(--list-border);
    }

    /* Modal */
    .modal{ position:fixed; inset:0; background:rgba(0,0,0,.55); display:none; align-items:center; justify-content:center; }
    .panel{
      background:inherit; color:inherit;
      border:1px solid var(--list-border); width:min(92vw, 860px);
      max-height:90vh; overflow:auto; padding:18px;
    }
    .panel pre{ white-space:pre-wrap; word-wrap:break-word; }
  </style>
</head>
<body>
  <h1> Hsin yun booooklist </h1>

  <!-- View Aï¼šé¦–é ï¼ˆä¸Šï¼šæ›¸ç±åˆ†é¡ï¼Œä¸‹ï¼šæ—¥èªŒåˆ†é¡ï¼‰ -->
  <section id="view-tiles">
    <!-- æ›¸ç±åˆ†é¡ -->
    <div class="section-title">ğŸ“š æ›¸ç±åˆ†é¡</div>
    <div class="board">
      <div class="bar">
        <div style="font-weight:800;color:var(--cover-accent)">é¸ä¸€å€‹åˆ†é¡é–‹å§‹æ¢ç´¢</div>
        <div class="controls">
          <input id="qA" placeholder="ï¼ˆå¯é¸ï¼‰æœå°‹å…¨éƒ¨æ›¸åº«" />
          <button id="searchAll" class="btn">æœå°‹</button>
        </div>
      </div>
      <div class="tiles" id="tiles-books">
        <!-- ä¾ä½ çš„ 10 é¡ -->
        <button class="tile" data-mode="books" data-cat="ğŸ¨ è—è¡“èˆ‡è¨­è¨ˆ" data-slug="art-design">ğŸ¨ è—è¡“èˆ‡è¨­è¨ˆ</button>
        <button class="tile" data-mode="books" data-cat="ğŸ”Š è²éŸ³èˆ‡éŸ³æ¨‚" data-slug="sound-music">ğŸ”Š è²éŸ³èˆ‡éŸ³æ¨‚</button>
        <button class="tile" data-mode="books" data-cat="ğŸ§  å¿ƒæ™ºèˆ‡å¿ƒç†å­¸" data-slug="mind-psych">ğŸ§  å¿ƒæ™ºèˆ‡å¿ƒç†å­¸</button>
        <button class="tile" data-mode="books" data-cat="ğŸŒŒ å“²å­¸èˆ‡ç§‘æ™®" data-slug="philosophy-science">ğŸŒŒ å“²å­¸èˆ‡ç§‘æ™®</button>
        <button class="tile" data-mode="books" data-cat="ğŸ“ˆ ç¶“æ¿Ÿèˆ‡ç¤¾æœƒè§€å¯Ÿ" data-slug="economy-society">ğŸ“ˆ ç¶“æ¿Ÿèˆ‡ç¤¾æœƒè§€å¯Ÿ</button>
        <button class="tile" data-mode="books" data-cat="âœï¸ èªè¨€èˆ‡è¡¨é”" data-slug="language-expression">âœï¸ èªè¨€èˆ‡è¡¨é”</button>
        <button class="tile" data-mode="books" data-cat="ğŸ§­ è‡ªæˆ‘æˆé•·èˆ‡äººç”Ÿè¨­è¨ˆ" data-slug="self-growth-design">ğŸ§­ è‡ªæˆ‘æˆé•·èˆ‡äººç”Ÿè¨­è¨ˆ</button>
        <button class="tile" data-mode="books" data-cat="ğŸ‘ï¸â€ğŸ—¨ï¸ æ„Ÿå®˜èˆ‡é¢¨æ ¼" data-slug="senses-style">ğŸ‘ï¸â€ğŸ—¨ï¸ æ„Ÿå®˜èˆ‡é¢¨æ ¼</button>
        <button class="tile" data-mode="books" data-cat="ğŸ“š çŸ¥è­˜èˆ‡æ–‡æ˜å²" data-slug="knowledge-civilization">ğŸ“š çŸ¥è­˜èˆ‡æ–‡æ˜å²</button>
        <button class="tile" data-mode="books" data-cat="ğŸ§° å‰µæ–°èˆ‡å•é¡Œè§£æ±º" data-slug="innovation-problem">ğŸ§° å‰µæ–°èˆ‡å•é¡Œè§£æ±º</button>
      </div>
    </div>

    <!-- æ—¥èªŒåˆ†é¡ï¼ˆæ–°ï¼‰ -->
    <div class="section-title">ğŸ“ æ—¥èªŒ</div>
    <div class="board">
      <div class="bar">
        <div style="font-weight:800;color:var(--cover-accent)">é¸ä¸€å€‹ä¸»é¡Œé–‹å§‹æ›¸å¯« / æª¢è¦–</div>
        <div class="controls">
          <input id="qJ" placeholder="ï¼ˆå¯é¸ï¼‰æœå°‹å…¨éƒ¨æ—¥èªŒ" />
          <button id="searchLogs" class="btn">æœå°‹</button>
        </div>
      </div>
      <div class="tiles" id="tiles-logs">
        <!-- ä½ å¯è‡ªè¨‚è¦å¹¾é¡ -->
        <button class="tile" data-mode="logs" data-cat="éˆæ„Ÿ" data-slug="ideas">éˆæ„Ÿ</button>
        <button class="tile" data-mode="logs" data-cat="å·¥ä½œç­†è¨˜" data-slug="work">å·¥ä½œç­†è¨˜</button>
        <button class="tile" data-mode="logs" data-cat="é–±è®€æ‘˜éŒ„" data-slug="reading">é–±è®€æ‘˜éŒ„</button>
      </div>
    </div>
  </section>

  <!-- View Bï¼šæ¸…å–®é ï¼ˆå…±ç”¨ï¼šæ›¸ç± / æ—¥èªŒï¼‰ -->
  <section id="view-gallery" class="hidden">
    <div class="bar">
      <div style="display:flex;gap:8px;align-items:center;">
        <button id="back" class="btn">â† è¿”å›é¦–é </button>
        <div id="pickedCat" style="font-weight:800;"></div>
        <div id="count" class="meta"></div>
      </div>
      <div class="controls" style="display:flex; gap:8px;">
        <select id="sort">
          <option value="title.asc">æ¨™é¡Œ Aâ†’Z</option>
          <option value="title.desc">æ¨™é¡Œ Zâ†’A</option>
          <option value="year.desc">å¹´ä»½ æ–°â†’èˆŠ</option>
          <option value="year.asc">å¹´ä»½ èˆŠâ†’æ–°</option>
          <option value="date.desc">æ—¥æœŸ æ–°â†’èˆŠï¼ˆåƒ…æ—¥èªŒï¼‰</option>
          <option value="date.asc">æ—¥æœŸ èˆŠâ†’æ–°ï¼ˆåƒ…æ—¥èªŒï¼‰</option>
        </select>
        <input id="qB" placeholder="æ­¤æ¸…å–®å…§æœå°‹" />
      </div>
    </div>
    <div class="grid" id="grid"></div>
  </section>

  <!-- è©³æƒ… Modalï¼ˆæ›¸ç±ï¼šmetaï¼›æ—¥èªŒï¼šentry.mdï¼‰ -->
  <div class="modal" id="modal" onclick="if(event.target===this)this.style.display='none'">
    <div class="panel" id="panel"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/fuse.js@7.0.0"></script>
  <script>
    /* DOM */
    const $tiles = document.getElementById('view-tiles');
    const $gallery = document.getElementById('view-gallery');
    const $grid = document.getElementById('grid');
    const $pickedCat = document.getElementById('pickedCat');
    const $count = document.getElementById('count');
    const $modal = document.getElementById('modal');
    const $panel = document.getElementById('panel');
    const $sort = document.getElementById('sort');
    const $qA = document.getElementById('qA');
    const $qJ = document.getElementById('qJ');
    const $qB = document.getElementById('qB');
    const $searchAll = document.getElementById('searchAll');
    const $searchLogs = document.getElementById('searchLogs');
    const $back = document.getElementById('back');

    /* ç‹€æ…‹ */
    let MODE = 'books';        // 'books' | 'logs'
    let currentCat = '';       // slug/name
    let SLUG2NAME = {};        // æ›¸ç± slug -> é¡¯ç¤ºå
    let LOG_SLUG2NAME = {};    // æ—¥èªŒ slug -> é¡¯ç¤ºå

    let books = [];
    let logs = [];
    let fuseBooks, fuseLogs;

    /* è¼”åŠ©ï¼šæ’åº */
    function bySort(list) {
      const [key, dir] = $sort.value.split('.');
      const sgn = dir === 'asc' ? 1 : -1;

      if (MODE === 'logs' && (key === 'date')) {
        list.sort((a,b)=>{
          const ta = a.date ? new Date(a.date).getTime() : 0;
          const tb = b.date ? new Date(b.date).getTime() : 0;
          return sgn * (ta - tb);
        });
        return list;
      }

      if (key === 'year') {
        list.sort((a,b)=>{
          const av = Number.isFinite(a.year) ? a.year : -Infinity;
          const bv = Number.isFinite(b.year) ? b.year : -Infinity;
          return sgn * (av - bv);
        });
        return list;
      }

      // é è¨­ä»¥ title
      list.sort((a,b)=> sgn * ((a.title||'').toLowerCase().localeCompare((b.title||'').toLowerCase())));
      return list;
    }

    /* è¼‰å…¥è³‡æ–™ */
    async function load() {
      // æ›¸ç± slug -> åç¨±
      SLUG2NAME = Object.fromEntries([...document.querySelectorAll('#tiles-books .tile')].map(btn => [btn.dataset.slug, btn.dataset.cat]));
      LOG_SLUG2NAME = Object.fromEntries([...document.querySelectorAll('#tiles-logs .tile')].map(btn => [btn.dataset.slug, btn.dataset.cat]));

      // è®€æ›¸ç±ç´¢å¼•
      try{
        const res = await fetch('./data/books_index.json', { cache:'no-store' });
        books = res.ok ? await res.json() : [];
      }catch{ books = []; }
      fuseBooks = books.length ? new Fuse(books, { keys:['title','author','tags','summary'], threshold:0.35, ignoreLocation:true }) : null;

      // è®€æ—¥èªŒç´¢å¼•ï¼ˆæ–°ï¼‰
      try{
        const res = await fetch('./data/logs_index.json', { cache:'no-store' });
        logs = res.ok ? await res.json() : [];
      }catch{ logs = []; }
      fuseLogs = logs.length ? new Fuse(logs, { keys:['title','tags','summary','content'], threshold:0.35, ignoreLocation:true }) : null;

      bindTiles();
      bindSearch();
      restoreFromHash();
    }

    function bindTiles(){
      document.querySelectorAll('.tile').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const mode = btn.dataset.mode;
          const slug = btn.dataset.slug;
          const name = btn.dataset.cat;
          openCategory(mode, slug, name);
        });
      });
    }

    function bindSearch(){
      $searchAll.addEventListener('click', ()=>{
        MODE='books';
        const q = $qA.value.trim();
        const list = (q && fuseBooks) ? fuseBooks.search(q).map(r=>r.item) : books.slice();
        enterGallery();
        $pickedCat.textContent = 'æœå°‹çµæœï¼ˆæ›¸ç±ï¼‰';
        showGallery(list);
        history.replaceState(null,'','#'+new URLSearchParams({view:'search',mode:'books',q}).toString());
      });
      $qA.addEventListener('keydown', e=>{ if(e.key==='Enter') $searchAll.click(); });

      $searchLogs.addEventListener('click', ()=>{
        MODE='logs';
        const q = $qJ.value.trim();
        const list = (q && fuseLogs) ? fuseLogs.search(q).map(r=>r.item) : logs.slice();
        enterGallery();
        $pickedCat.textContent = 'æœå°‹çµæœï¼ˆæ—¥èªŒï¼‰';
        showGallery(list);
        history.replaceState(null,'','#'+new URLSearchParams({view:'search',mode:'logs',q}).toString());
      });
      $qJ.addEventListener('keydown', e=>{ if(e.key==='Enter') $searchLogs.click(); });

      $qB.addEventListener('input', ()=>{
        const base = MODE==='books'
          ? (currentCat ? books.filter(b=>b.category_slug===currentCat || b.category===SLUG2NAME[currentCat]) : books.slice())
          : (currentCat ? logs.filter(l=>l.type===currentCat) : logs.slice());
        showGallery(base);
      });

      $sort.addEventListener('input', ()=>{
        const base = MODE==='books'
          ? (currentCat ? books.filter(b=>b.category_slug===currentCat || b.category===SLUG2NAME[currentCat]) : books.slice())
          : (currentCat ? logs.filter(l=>l.type===currentCat) : logs.slice());
        showGallery(base);
      });

      $back.addEventListener('click', ()=>{
        $gallery.classList.add('hidden');
        $tiles.classList.remove('hidden');
        history.replaceState(null,'','#');
      });
    }

    function enterGallery(){
      $tiles.classList.add('hidden');
      $gallery.classList.remove('hidden');
    }

    function openCategory(mode, slug, name){
      MODE = mode;
      currentCat = slug;
      $pickedCat.textContent = (mode==='books' ? (name || SLUG2NAME[slug] || slug) : (name || LOG_SLUG2NAME[slug] || slug));
      enterGallery();

      const list = mode==='books'
        ? books.filter(b=>b.category_slug===slug || b.category===name)
        : logs.filter(l=>l.type===slug);

      showGallery(list);
      history.replaceState(null,'','#'+new URLSearchParams({view:'cat',mode,cat:slug,sort:$sort.value}).toString());
    }

    function showGallery(listSource){
      let list = listSource.slice();

      // å…§éƒ¨æœå°‹ï¼ˆè©²æ¸…å–®ï¼‰
      if ($qB.value.trim()){
        const fuse = MODE==='books'
          ? new Fuse(list, { keys:['title','author','tags','summary'], threshold:0.35, ignoreLocation:true })
          : new Fuse(list, { keys:['title','tags','summary','content'], threshold:0.35, ignoreLocation:true });
        list = fuse.search($qB.value.trim()).map(r=>r.item);
      }

      list = bySort(list);

      $count.textContent = `å…± ${list.length} ç­†`;
      if (MODE==='books'){
        $grid.innerHTML = list.map(b=>`
          <div class="card" data-mode="books" data-id="${b.id}">
            <div class="title">${b.title}</div>
            <div class="meta">${b.author||''}${b.year?' Â· '+b.year:''}</div>
            <div class="meta">${b.category || (SLUG2NAME[b.category_slug] ?? '')}</div>
            ${b.tags&&b.tags.length?`<div style='margin-top:8px'>${b.tags.map(t=>`<span class=tag>${t}</span>`).join('')}</div>`:''}
          </div>`).join('');
      }else{
        // æ—¥èªŒ
        $grid.innerHTML = list.map(l=>`
          <div class="card" data-mode="logs" data-id="${l.id}">
            <div class="title">${l.title || '(æœªå‘½å)'}</div>
            <div class="meta">${l.date || ''}${l.type? ' Â· '+(LOG_SLUG2NAME[l.type]||l.type):''}</div>
            ${l.tags&&l.tags.length?`<div style='margin-top:8px'>${l.tags.map(t=>`<span class=tag>${t}</span>`).join('')}</div>`:''}
            ${l.summary?`<div class="meta" style="margin-top:6px">${l.summary}</div>`:''}
          </div>`).join('');
      }

      $grid.querySelectorAll('.card').forEach(c=>{
        c.addEventListener('click',()=>openDetail(c.dataset.mode, c.dataset.id));
      });
    }

    async function openDetail(mode, id){
      try{
        if (mode==='books'){
          const meta = await (await fetch(`./data/books/${id}/meta.json`, { cache:'no-store' })).json();
          $panel.innerHTML = `
            <div>
              <h2 style="margin:0 0 6px">${meta.title||''}</h2>
              <div class="meta">${meta.author||''}${meta.year?' Â· '+meta.year:''}${meta.category?' Â· '+meta.category:''}</div>
              ${meta.isbn?`<div class="meta">ISBNï¼š${meta.isbn}</div>`:''}
              ${meta.summary?`<p style="margin-top:8px">${meta.summary}</p>`:''}
              ${Array.isArray(meta.tags)&&meta.tags.length?`<div style='margin-top:8px'>${meta.tags.map(t=>`<span class=tag>${t}</span>`).join('')}</div>`:''}
              <div style="margin-top:10px"><a href="./data/books/${id}/notes.md" target="_blank">ç­†è¨˜ï¼ˆnotes.mdï¼‰</a></div>
            </div>`;
        }else{
          // æ—¥èªŒè©³æƒ…ï¼šè®€ entry.md
          const md = await (await fetch(`./data/logs/${id}/entry.md`, { cache:'no-store' })).text();
          const item = logs.find(x=>x.id===id) || {};
          $panel.innerHTML = `
            <div>
              <h2 style="margin:0 0 6px">${item.title || '(æœªå‘½å)'}</h2>
              <div class="meta">${item.date || ''}${item.type? ' Â· '+(LOG_SLUG2NAME[item.type]||item.type):''}</div>
              ${item.tags&&item.tags.length?`<div style='margin-top:8px'>${item.tags.map(t=>`<span class=tag>${t}</span>`).join('')}</div>`:''}
              ${item.summary?`<p style="margin-top:8px">${item.summary}</p>`:''}
              <hr style="border:none;border-top:1px solid ${getComputedStyle(document.body).getPropertyValue('--list-border')};margin:12px 0">
              <pre>${md.replace(/[&<>]/g,s=>({'&':'&amp;','<':'&lt;','>':'&gt;'}[s]))}</pre>
            </div>`;
        }
        $modal.style.display='flex';
      }catch(e){
        $panel.innerHTML = `<p>è¼‰å…¥å…§å®¹å¤±æ•—ï¼ˆ${id}ï¼‰ã€‚</p>`;
        $modal.style.display='flex';
      }
    }

    function restoreFromHash(){
      const p = new URLSearchParams(location.hash.slice(1));
      const view = p.get('view');
      if (view === 'cat'){
        openCategory(p.get('mode')||'books', p.get('cat')||'', null);
      }else if (view === 'search'){
        const mode = p.get('mode')||'books';
        if (mode==='books') $searchAll.click(); else $searchLogs.click();
      }
    }

    load();
  </script>
</body>
</html>