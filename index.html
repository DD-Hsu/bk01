<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title> HSIN YUN booklist (æ›¸åº«) </title>
  <style>
    :root{
      --navy:#233d4d;      /* æ·±è—åº• */
      --navy-2:#2a4a60;    /* æ¬¡å±¤æ·±è— */
      --ivory:#f2eee8;     /* æ·ºè±¡ç‰™å­— */
      --ivory-2:#cfc7bb;   /* æ¬¡å­—/é‚Šæ¡† */
      --pumpkin:#fe7f2d;   /* æ©˜è‰²å¡ç‰‡ */
      --pumpkin-2:#ff984f; /* æ©˜è‰² hover */
      --gap:16px;
      --pt2: 2pt;          /* é¦–é å­—é«”åŠ  2pt */
    }
    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:24px;
      background:var(--navy);
      color:var(--ivory);
      font-family: Georgia, "Times New Roman", Times, serif;
      line-height:1.6;
      letter-spacing:.15px;
    }
    h1,h2{ margin:0 0 10px; font-weight:800; }
    h1{ font-size: clamp(28px, 4vw, 42px); }
    a{ color:inherit; text-decoration:none; border-bottom:1px solid transparent; }
    a:hover{ border-bottom-color:currentColor; }
    .hidden{ display:none !important; }

    /* --- é¦–é å€ï¼ˆåˆ†é¡ç£šï¼‰ï¼Œå­—é«”æ•´é«” +2ptï¼Œç„¡åœ“è§’ --- */
    #view-tiles{ font-size: calc(16px + var(--pt2)); }
    .board{
      background:transparent;
      padding:18px;
      border:1px solid var(--ivory-2);
    }
    .tiles{
      display:grid;
      grid-template-columns: repeat(auto-fill, minmax(220px,1fr));
      gap:var(--gap);
      margin-top:10px;
    }
    .tile{
      display:flex; align-items:center;
      gap:12px; padding:14px 16px;
      background:transparent;
      color:var(--ivory);
      border:1px solid var(--ivory-2);
      cursor:pointer; font-weight:800;
      /* ç„¡åœ“è§’ */
    }
    .tile:hover{ background:var(--navy-2); border-color:var(--pumpkin); color:var(--pumpkin); }

    /* --- å·¥å…·åˆ—ï¼ˆæœå°‹/æ’åº/è¿”å›ï¼‰ï¼Œç„¡åœ“è§’ --- */
    .bar{
      display:flex; gap:12px; align-items:center; justify-content:space-between;
      margin: 12px 0; flex-wrap:wrap;
    }
    .btn{
      padding:8px 12px;
      border:1px solid var(--ivory-2);
      background:transparent;
      color:var(--ivory);
      cursor:pointer; font-weight:800;
    }
    .btn:hover{ border-color:var(--pumpkin); color:var(--pumpkin); }
    .controls input, .controls select{
      padding:8px 10px; font-size:14px; outline:none;
      border:1px solid var(--ivory-2); background:transparent; color:var(--ivory);
    }
    .controls input::placeholder{ color:#bfb8aa; }

    /* --- åˆ†é¡ç•«å»Šï¼ˆmasonryï¼‰èƒŒæ™¯ä»æ·±è—ï¼›å¡ç‰‡ç‚ºæ©˜è‰² --- */
    .grid{ column-count: 3; column-gap: var(--gap); }
    @media (max-width: 1100px){ .grid{ column-count:2; } }
    @media (max-width: 700px){ .grid{ column-count:1; } }

    .card{
      display:inline-block; width:100%;
      border:1px solid var(--navy);
      background:var(--pumpkin);   /* æ©˜è‰²å¡ç‰‡åº• */
      color:var(--navy);           /* æ·±è—æ–‡å­— */
      padding:14px; margin:0 0 var(--gap); cursor:pointer;
      transition: background .15s ease, border-color .15s ease, color .15s ease;
      /* ç„¡åœ“è§’ */
    }
    .card:hover{ background:var(--pumpkin-2); border-color:#1b2f3c; }
    .title{ font-weight:900; }
    .meta{ opacity:.85; font-size:13px; }
    .tag{
      display:inline-block; padding:2px 8px; margin:6px 6px 0 0; font-size:12px;
      border:1px solid var(--navy); color:var(--navy);
    }

    /* --- è©³æƒ… Modalï¼ˆç´”æ–‡å­—ï¼‰ï¼Œæ²¿ç”¨æ·±è—åº•/è±¡ç‰™å­— --- */
    .modal{ position:fixed; inset:0; background:rgba(0,0,0,.55); display:none; align-items:center; justify-content:center; }
    .panel{
      background:var(--navy);
      color:var(--ivory);
      border:1px solid var(--ivory-2);
      width:min(92vw, 860px);
      max-height:90vh; overflow:auto; padding:18px;
      /* ç„¡åœ“è§’ */
    }
  </style>
</head>
<body>
  <h1>æˆ‘çš„æ›¸ç±è³‡æ–™åº«</h1>

  <!-- A. é¦–é ï¼šåˆ†é¡ -->
  <section id="view-tiles">
    <div class="board">
      <div class="bar">
        <div style="font-weight:800;color:var(--pumpkin);">é¸ä¸€å€‹åˆ†é¡é–‹å§‹æ¢ç´¢</div>
        <div class="controls">
          <input id="qA" placeholder="ï¼ˆå¯é¸ï¼‰æœå°‹å…¨éƒ¨æ›¸åº«" />
          <button id="searchAll" class="btn">æœå°‹</button>
        </div>
      </div>
      <div class="tiles">
        <button class="tile" data-cat="ğŸ¨ è—è¡“èˆ‡è¨­è¨ˆ" data-slug="art-design">ğŸ¨ è—è¡“èˆ‡è¨­è¨ˆ</button>
        <button class="tile" data-cat="ğŸ”Š è²éŸ³èˆ‡éŸ³æ¨‚" data-slug="sound-music">ğŸ”Š è²éŸ³èˆ‡éŸ³æ¨‚</button>
        <button class="tile" data-cat="ğŸ§  å¿ƒæ™ºèˆ‡å¿ƒç†å­¸" data-slug="mind-psych">ğŸ§  å¿ƒæ™ºèˆ‡å¿ƒç†å­¸</button>
        <button class="tile" data-cat="ğŸŒŒ å“²å­¸èˆ‡ç§‘æ™®" data-slug="philosophy-science">ğŸŒŒ å“²å­¸èˆ‡ç§‘æ™®</button>
        <button class="tile" data-cat="ğŸ“ˆ ç¶“æ¿Ÿèˆ‡ç¤¾æœƒè§€å¯Ÿ" data-slug="economy-society">ğŸ“ˆ ç¶“æ¿Ÿèˆ‡ç¤¾æœƒè§€å¯Ÿ</button>
        <button class="tile" data-cat="âœï¸ èªè¨€èˆ‡è¡¨é”" data-slug="language-expression">âœï¸ èªè¨€èˆ‡è¡¨é”</button>
        <button class="tile" data-cat="ğŸ§­ è‡ªæˆ‘æˆé•·èˆ‡äººç”Ÿè¨­è¨ˆ" data-slug="self-growth-design">ğŸ§­ è‡ªæˆ‘æˆé•·èˆ‡äººç”Ÿè¨­è¨ˆ</button>
        <button class="tile" data-cat="ğŸ‘ï¸â€ğŸ—¨ï¸ æ„Ÿå®˜èˆ‡é¢¨æ ¼" data-slug="senses-style">ğŸ‘ï¸â€ğŸ—¨ï¸ æ„Ÿå®˜èˆ‡é¢¨æ ¼</button>
        <button class="tile" data-cat="ğŸ“š çŸ¥è­˜èˆ‡æ–‡æ˜å²" data-slug="knowledge-civilization">ğŸ“š çŸ¥è­˜èˆ‡æ–‡æ˜å²</button>
        <button class="tile" data-cat="ğŸ§° å‰µæ–°èˆ‡å•é¡Œè§£æ±º" data-slug="innovation-problem">ğŸ§° å‰µæ–°èˆ‡å•é¡Œè§£æ±º</button>
      </div>
    </div>
  </section>

  <!-- B. åˆ†é¡ç•«å»Šé ï¼ˆèƒŒæ™¯æ·±è—ã€å¡ç‰‡æ©˜ï¼‰ -->
  <section id="view-gallery" class="hidden">
    <div class="bar">
      <div style="display:flex;gap:8px;align-items:center;">
        <button id="back" class="btn">â† è¿”å›åˆ†é¡</button>
        <div id="pickedCat" style="font-weight:800;color:var(--ivory);"></div>
        <div id="count" class="meta"></div>
      </div>
      <div class="controls" style="display:flex; gap:8px;">
        <select id="sort" title="æ’åº">
          <option value="title.asc">æ¨™é¡Œ Aâ†’Z</option>
          <option value="title.desc">æ¨™é¡Œ Zâ†’A</option>
          <option value="year.desc">å¹´ä»½ æ–°â†’èˆŠ</option>
          <option value="year.asc">å¹´ä»½ èˆŠâ†’æ–°</option>
        </select>
        <input id="qB" placeholder="åœ¨æ­¤åˆ†é¡å…§æœå°‹" />
      </div>
    </div>
    <div class="grid" id="grid"></div>
  </section>

  <!-- è©³æƒ… Modalï¼ˆç„¡åœ–ç‰‡ï¼‰ -->
  <div class="modal" id="modal" onclick="if(event.target===this)this.style.display='none'">
    <div class="panel" id="panel"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/fuse.js@7.0.0"></script>
  <script>
    const $tiles = document.getElementById('view-tiles');
    const $gallery = document.getElementById('view-gallery');
    const $grid = document.getElementById('grid');
    const $pickedCat = document.getElementById('pickedCat');
    const $count = document.getElementById('count');
    const $modal = document.getElementById('modal');
    const $panel = document.getElementById('panel');
    const $sort = document.getElementById('sort');
    const $qA = document.getElementById('qA');
    const $qB = document.getElementById('qB');
    const $searchAll = document.getElementById('searchAll');
    const $back = document.getElementById('back');

    let books = [];
    let fuseAll;
    let currentCat = ''; // slug
    let SLUG2NAME = {};  // slug -> é¡¯ç¤ºåç¨±

    function bySort(list) {
      const [key, dir] = $sort.value.split('.');
      list.sort((a, b) => {
        if (key === 'year') {
          const av = Number.isFinite(a.year) ? a.year : -Infinity;
          const bv = Number.isFinite(b.year) ? b.year : -Infinity;
          return dir === 'asc' ? av - bv : bv - av;
        }
        const va = (a.title || '').toLowerCase();
        const vb = (b.title || '').toLowerCase();
        return dir === 'asc' ? va.localeCompare(vb) : vb.localeCompare(va);
      });
      return list;
    }

    async function load() {
      SLUG2NAME = Object.fromEntries([...document.querySelectorAll('.tile')].map(btn => [btn.dataset.slug, btn.dataset.cat]));

      try {
        const res = await fetch('./data/books_index.json', { cache: 'no-store' });
        if (!res.ok) throw new Error('HTTP ' + res.status);
        books = await res.json();
      } catch (e) {
        alert('è¼‰å…¥ data/books_index.json å¤±æ•—ï¼š' + e.message);
        books = [];
      }
      fuseAll = books.length ? new Fuse(books, { keys:['title','author','tags','summary'], threshold:0.35, ignoreLocation:true }) : null;

      bindTiles();
      restoreFromHash();
    }

    function bindTiles() {
      document.querySelectorAll('.tile').forEach(btn => {
        btn.addEventListener('click', () => openCat(btn.dataset.slug, btn.dataset.cat));
      });
      $searchAll.addEventListener('click', () => {
        const q = $qA.value.trim();
        const list = (q && fuseAll) ? fuseAll.search(q).map(r => r.item) : books.slice();
        openResult('æœå°‹çµæœ', list);
      });
      $qA.addEventListener('keydown', e => { if (e.key === 'Enter') $searchAll.click(); });
    }

    function openResult(title, list){
      $pickedCat.textContent = title;
      showGallery(list);
      const p = new URLSearchParams({ view: 'cat', cat: '', sort: $sort.value });
      history.replaceState(null, '', '#' + p.toString());
    }

    function openCat(slug, name) {
      currentCat = slug;
      $pickedCat.textContent = name || (SLUG2NAME[slug] ?? slug);
      const list = books.filter(b => b.category_slug === slug || b.category === name);
      showGallery(list);
      const p = new URLSearchParams({ view: 'cat', cat: slug, sort: $sort.value });
      history.replaceState(null, '', '#' + p.toString());
    }

    function showGallery(listSource) {
      $tiles.classList.add('hidden');
      $gallery.classList.remove('hidden');

      let list = listSource.slice();
      if ($qB.value.trim()) {
        const fuseCat = new Fuse(list, { keys: ['title','author','tags','summary'], threshold: 0.35, ignoreLocation: true });
        list = fuseCat.search($qB.value.trim()).map(r => r.item);
      }
      list = bySort(list);

      $count.textContent = `å…± ${list.length} æœ¬`;
      $grid.innerHTML = list.map(b => `
        <div class="card" data-id="${b.id}">
          <div class="title">${b.title}</div>
          <div class="meta">${b.author||''}${b.year?' Â· '+b.year:''}</div>
          <div class="meta">${b.category || (SLUG2NAME[b.category_slug] ?? '')}</div>
          ${b.tags&&b.tags.length?`<div style='margin-top:8px'>${b.tags.map(t=>`<span class=tag>${t}</span>`).join('')}</div>`:''}
        </div>`).join('');

      $grid.querySelectorAll('.card').forEach(c => c.addEventListener('click', () => openDetail(c.dataset.id)));
    }

    async function openDetail(id){
      try{
        const meta = await (await fetch(`./data/books/${id}/meta.json`, { cache: 'no-store' })).json();
        $panel.innerHTML = `
          <div>
            <h2 style="margin:0 0 6px">${meta.title||''}</h2>
            <div class="meta">${meta.author||''}${meta.year?' Â· '+meta.year:''}${meta.category?' Â· '+meta.category:''}</div>
            ${meta.isbn?`<div class="meta">ISBNï¼š${meta.isbn}</div>`:''}
            ${meta.summary?`<p style="margin-top:8px">${meta.summary}</p>`:''}
            ${Array.isArray(meta.tags)&&meta.tags.length?`<div style='margin-top:8px'>${meta.tags.map(t=>`<span class=tag style="border-color:var(--ivory-2);color:var(--ivory)">${t}</span>`).join('')}</div>`:''}

            ${meta.table_of_contents && meta.table_of_contents.length ? `
              <div style="margin-top:10px"><strong>ç›®éŒ„ï¼š</strong>
                <ul style="margin:6px 0 0 18px">${meta.table_of_contents.map(x=>`<li>${x}</li>`).join('')}</ul>
              </div>` : ''}

            ${meta.notes?.review ? `<div style="margin-top:10px"><strong>å¿ƒå¾—ï¼š</strong><div class="meta">${meta.notes.review}</div></div>` : '' }
            ${meta.notes?.insights?.length ? `<div style="margin-top:10px"><strong>é‡é»ï¼š</strong><ul style="margin:6px 0 0 18px">${meta.notes.insights.map(x=>`<li>${x}</li>`).join('')}</ul></div>` : '' }
            ${meta.notes?.quotes?.length ? `<div style="margin-top:10px"><strong>æ‘˜éŒ„ï¼š</strong><ul style="margin:6px 0 0 18px">${meta.notes.quotes.map(x=>`<li>${x}</li>`).join('')}</ul></div>` : '' }
            ${meta.notes?.todo?.length ? `<div style="margin-top:10px"><strong>è¡Œå‹•ï¼š</strong><ul style="margin:6px 0 0 18px">${meta.notes.todo.map(x=>`<li>${x}</li>`).join('')}</ul></div>` : '' }

            <div style="margin-top:10px"><a href="./data/books/${id}/notes.md" target="_blank">ç­†è¨˜ï¼ˆnotes.mdï¼‰</a></div>
          </div>`;
        $modal.style.display='flex';
      }catch(e){
        $panel.innerHTML = `<p>æ‰¾ä¸åˆ°æ­¤æ›¸çš„ meta.jsonï¼ˆ${id}ï¼‰ã€‚</p>`;
        $modal.style.display='flex';
      }
    }

    document.getElementById('qB').addEventListener('input', () => {
      const base = currentCat ? books.filter(b => b.category_slug === currentCat) : books.slice();
      showGallery(base);
    });
    document.getElementById('sort').addEventListener('input', () => {
      const base = currentCat ? books.filter(b => b.category_slug === currentCat) : books.slice();
      showGallery(base);
    });
    document.getElementById('back').addEventListener('click', () => {
      $gallery.classList.add('hidden');
      $tiles.classList.remove('hidden');
      history.replaceState(null, '', '#');
    });

    function restoreFromHash(){
      const p = new URLSearchParams(location.hash.slice(1));
      if (p.get('view') === 'cat') {
        const slug = p.get('cat') || '';
        openCat(slug, SLUG2NAME[slug]);
      }
    }

    load();
  </script>
</body>
</html>